<!DOCTYPE html>
<html class='no-js'>
  <head>
    <meta charset="utf-8">
    <title>Structuring JavaScript</title>
    <meta name='description' content=''>
    <meta name='author' content=''>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <link rel="stylesheet" href="assets/css/tomorrow-night.css">
    <link rel='stylesheet' href='assets/css/main.css'>
    <link rel='stylesheet' href='assets/css/calc.css'>
    <script src='assets/js/libs/modernizr.js'></script>
    <script src='assets/js/libs/prettify.js'></script>
    <script src='assets/js/libs/moment.js'></script>
  </head>
  <body>
    <div id="container" class='clearfix'>
      <header role='banner'>
        <div class='center'>
          <h1>Give your JS apps some structure.</h1>
          <p>
            closures, namespaces and other tools to keep our code manageable
          </p>
        </div>
      </header>
      <div id="nav-bar" class="nav-bar">
        <div class='center'>
          <a href="#menu" class="menu-link">Menu</a>
          <nav id='menu' role='navigation'>
            <ul>
              <li><a href="index.html">structure</a></li>
              <li><a href="proto.html">prototype</a></li>
              <li><a href="mod.html">module pattern</a></li>
              <li><a href="#">revealing</a></li>
              <li><a href="#">revealing prototype</a></li>
            </ul>
          </nav>
        </div>
      </div>

      <div id="main-content" role='main'>
        <div class='center'>
          <h1>Module Pattern</h1>
        <h2>Using the Module Pattern to create a calculator</h2>
        <!-- Note: I prefer to wire up event handlers via code in "real life" apps
             but in this case I decided to do it in HTML just to allow the focus to stay
             on patterns. -->
        <div class="calculator">
            <div class="calculatorHead">
                <div id="eq" class="equation"></div>
                <div id="currNumber" class="currentNumber">0</div>
            </div>
            <div class='row'>
                <div class="num button">7</div>
                <div class="num button">8</div>
                <div class="num button">9</div>
                <div id='divide'class="button" onclick="calc.setOperator('/');">/</div>
                <div class="clr button rowspan2" onclick="calc.clearNumbers();">C</div>
            </div>
            <div class='row'>
                <div class="num button">4</div>
                <div class="num button">5</div>
                <div class="num button">6</div>
                <div id='multi' class="button" onclick="calc.setOperator('*');">*</div>
            </div class='row'>
            <div class='row'>
                <div class="num button">1</div>
                <div class="num button">2</div>
                <div class="num button">3</div>
                <div id='min' class="button" onclick="calc.setOperator('-')">-</div>
                <div id='eql' class="button rowspan2" onclick="calc.setOperator('=');">=</div>
            </div class='row'>
            <div class='row'>
                <div class="num button colspan2">0</div>
                <div class="num button">.</div>
                <div id='add' class="button" onclick="calc.setOperator('+');">+</div>
            </div>
        </div>

          <div id="eq"></div>
          <div id="output"></div>
          <div id="output2"></div>
    <pre class='prettyprint code'>
      // The module pattern looks familiar
      // Except that it has concepts of public and private
      var Calculator = function (eq) {
        //private member
        var eqCtl = document.getElementById(eq);

        return {
          // expose public member
          add: function (x, y) {
            var val = x + y;
            eqCtl.innerHTML += val;
          }
        };
      };
    </pre>
    <pre class='prettyprint code'>
var myNS = myNS || {};

myNS.Calculator = function (equals, currNumber) {
  var eqCtl = equals,
    currNumberCtl = currNumber,
    operator,
    operatorSet = false,
    equalsPressed = false,
    lastNumber = null,

    add = function(x, y) {
      return x + y;
    },

    subtract = function(x, y) {
      return x - y;
    },

    multiply = function(x, y) {
      return x * y;
    },

    divide = function(x, y) {
      if (y === 0) {
        alert("Can't divide by 0");
        return 0;
      }
      return x / y;
    },

    setVal = function(val) {
      currNumberCtl.innerHTML = val;
    },

    setEquation = function(val) {
      eqCtl.innerHTML = val;
    },

    calculate = function() {
      if (!operator || lastNumber === null) return;
      var currNumber = parseFloat(currNumberCtl.innerHTML),
          newVal = 0;
      switch (operator) {
      case '+':
        newVal = add(lastNumber, currNumber);
        break;
      case '-':
        newVal = subtract(lastNumber, currNumber);
        break;
      case '*':
        newVal = multiply(lastNumber, currNumber);
        break;
      case '/':
        newVal = divide(lastNumber, currNumber);
        break;
      }
      setVal(newVal.toFixed(2));
      lastNumber = newVal;
    };

  //public members
  return {
    numberClick: function(e) {
      var button = document.getElementsByClassName('num');
      for (var i = 0, len = button.length; i < len; i++) {
        button[i].addEventListener('click', calc.numberClick, false);
      }
      button = (e.target) ? e.target : e.srcElement;
      if (operatorSet === true || currNumberCtl.innerHTML === '0') {
        setVal('');
        operatorSet = false;
      }
      setVal(currNumberCtl.innerHTML + button.innerHTML);
      setEquation(eqCtl.innerHTML + button.innerHTML);
    },
    setOperator: function(newOperator) {
      if (newOperator === '=') {
        equalsPressed = true;
        calculate();
        setEquation('');
        return;
      }
      //Handle case where = was pressed
      //followed by an operator (+, -, *, /)
      if (!equalsPressed) calculate();
      equalsPressed = false;
      operator = newOperator;
      operatorSet = true;
      lastNumber = parseFloat(currNumberCtl.innerHTML);
      var eqText = (eqCtl.innerHTML === '') ?
        lastNumber + ' ' + operator + ' ' :
        eqCtl.innerHTML + ' ' + operator + ' ';
      setEquation(eqText);
    },
    clearNumbers: function() {
      lastNumber = null;
      equalsPressed = operatorSet = false;
      setVal('0');
      setEquation('');
    }
  };
};

var eqCtl = document.getElementById('eq');
var currNumberCtl = document.getElementById('currNumber');
calc = new myNS.Calculator(eqCtl, currNumberCtl);

// getElementsByClassName will not work in IE &lt; 8
// must find a better way to do this
// removed inline event handlers
var button = document.getElementsByClassName('num');

for (var i = 0, len = button.length; i &lt; len; i++) {
  button[i].addEventListener('click', calc.numberClick, false);
}

    </pre>
        </div>
      </div>
    </div>

    <footer id="main-footer" class='clearfix' role='info'>
      <div class="center">
        <p>Copyright 2014 &copy; Tony Brown Design and Development</p>
         <p id='datetime'></p>
         <a class='go-top' href="#top">go top</a>
      </div>
    </footer>

    <script src='assets/js/libs/jquery.js'></script>
    <script src='assets/js/libs/underscore.js'></script>
    <script src='assets/js/libs/backbone.js'></script>
    <script src='assets/js/libs/marionette.js'></script>
    <script src='assets/js/mod.js'></script>
  </body>
</html>
